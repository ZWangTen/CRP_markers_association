---
title: "Secondary analysis"
author: "Leslie (ZW)"
date: "2024-05-14"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(survey)
library(tidyverse)
library(dummy)
library(glmnet)
library(svyVGAM)
library(knitr)
library(haven)
library(mgcv)
```

# Secondary Analysis

## Association Sleep vs Metabolic Comorbidities

### Data preparation
```{r}
# Read data
pheno <- read.csv('~/OneDrive - Beth Israel Lahey Health/2023_methCRP/Data/20240205_pheSol.csv')
ev5 <- read.csv("/Volumes/Sofer Lab/HCHS_SOL/Ancestry_files/UW_GAC_DMDA_20180516_local_ancestries/subject_annotation_2017-09-05.csv")
names(ev5)[2]<-'SOL_ID'

# Add genetic PCs
pheno <- merge(pheno, ev5[,c(2,5:9)],by='SOL_ID')
# Set reference level for diabetes and hypertension
pheno$DIABETES2_INDICATOR <-relevel(as.factor(pheno$DIABETES2_INDICATOR), ref = 'Normal' )
pheno$HYPERTENSION <-relevel(as.factor(pheno$HYPERTENSION), ref = 'Normal' )

# Create survey objects
survey_obj <- svydesign(id=~PSU_ID, strata=~STRAT, weights=~WEIGHT_FINAL_NORM_OVERALL, data=pheno)
survey_obj <- subset(survey_obj,  !is.na(lgCrp))

```

### Association without adjusting for MRS-CRP
```{r}
############## Sleep ~ diseases

# Diabetes
tab <- data.frame(pheno=c('SLPA54','SLPA91','SLPA92'),
                  coef=rep(1,3), p.val=rep(1,3),lower=rep(1,3),upper=rep(1,3))

for (i in 1:3){
    form <- as.formula(paste0(tab$pheno[i], paste('~ DIABETES2_INDICATOR + AGE + GENDER + BMI + CENTER + BKGRD1_C7 + EV1 + EV2 + EV3 + EV4 + EV5'))) #Zmrs_HEnet
    mod <- svyglm(form, design = survey_obj, family = "gaussian")
    tab$coef[i] <- summary(mod)$coefficients[2,1]
    tab$p.val[i] <- summary(mod)$coefficients[2,4]
    tab$lower[i] <- confint(mod)[2,1]
    tab$upper[i] <- confint(mod)[2,2]
  } 
diab <- tab %>% mutate(condition='Diabetes')

# Hypertension
tab <- data.frame(pheno=c('SLPA54','SLPA91','SLPA92'),
                  coef=rep(1,3), p.val=rep(1,3),lower=rep(1,3),upper=rep(1,3))

for (i in 1:3){
    form <- as.formula(paste0(tab$pheno[i], paste('~ HYPERTENSION + AGE + GENDER + BMI + CENTER + BKGRD1_C7 + EV1 + EV2 + EV3 + EV4 + EV5'))) #Zmrs_HEnet
    mod <- svyglm(form, design = survey_obj, family = "gaussian")
    tab$coef[i] <- summary(mod)$coefficients[2,1]
    tab$p.val[i] <- summary(mod)$coefficients[2,4]
    tab$lower[i] <- confint(mod)[2,1]
    tab$upper[i] <- confint(mod)[2,2]
  } 
hyp <- tab %>% mutate(condition='Hypertension')

# Cognitive score baseline
tab <- data.frame(pheno=c('SLPA54','SLPA91','SLPA92'),
                  coef=rep(1,3), p.val=rep(1,3),lower=rep(1,3),upper=rep(1,3))

for (i in 1:3){
    form <- as.formula(paste0(tab$pheno[i], paste('~ global_cog_score + AGE + GENDER + BMI + CENTER + BKGRD1_C7 + EV1 + EV2 + EV3 + EV4 + EV5'))) #Zmrs_HEnet
    mod <- svyglm(form, design = survey_obj, family = "gaussian")
    tab$coef[i] <- summary(mod)$coefficients[2,1]
    tab$p.val[i] <- summary(mod)$coefficients[2,4]
    tab$lower[i] <- confint(mod)[2,1]
    tab$upper[i] <- confint(mod)[2,2]
  } 
cg <- tab %>% mutate(condition='cog_baseline')

# Cognitive score change
tab <- data.frame(pheno=c('SLPA54','SLPA91','SLPA92'),
                  coef=rep(1,3), p.val=rep(1,3),lower=rep(1,3),upper=rep(1,3))

for (i in 1:3){
    form <- as.formula(paste0(tab$pheno[i], paste('~ global_cog_score_change + AGE + GENDER + BMI + CENTER + BKGRD1_C7 + EV1 + EV2 + EV3 + EV4 + EV5'))) #Zmrs_HEnet
    mod <- svyglm(form, design = survey_obj, family = "gaussian")
    tab$coef[i] <- summary(mod)$coefficients[2,1]
    tab$p.val[i] <- summary(mod)$coefficients[2,4]
    tab$lower[i] <- confint(mod)[2,1]
    tab$upper[i] <- confint(mod)[2,2]
  } 
cc <- tab %>% mutate(condition='cog_change')
res <- rbind(diab,hyp,cg,cc)
#write.csv(res,'~/OneDrive - Beth Israel Lahey Health/2023_methCRP/Results/Survey regression/20240517_slp_dis_wo.csv',row.names = F)
```

### Association after adjusting for MRS_CRP
```{r}
############## Sleep ~ diseases

# Diabetes
tab <- data.frame(pheno=c('SLPA54','SLPA91','SLPA92'),
                  coef=rep(1,3), p.val=rep(1,3),lower=rep(1,3),upper=rep(1,3))

for (i in 1:3){
    form <- as.formula(paste0(tab$pheno[i], paste('~ DIABETES2_INDICATOR + Zmrs_HEnet + AGE + GENDER + BMI + CENTER + BKGRD1_C7 + EV1 + EV2 + EV3 + EV4 + EV5'))) #Zmrs_HEnet
    mod <- svyglm(form, design = survey_obj, family = "gaussian")
    tab$coef[i] <- summary(mod)$coefficients[2,1]
    tab$p.val[i] <- summary(mod)$coefficients[2,4]
    tab$lower[i] <- confint(mod)[2,1]
    tab$upper[i] <- confint(mod)[2,2]
  } 
diab <- tab %>% mutate(condition='Diabetes')

# Hypertension
tab <- data.frame(pheno=c('SLPA54','SLPA91','SLPA92'),
                  coef=rep(1,3), p.val=rep(1,3),lower=rep(1,3),upper=rep(1,3))

for (i in 1:3){
    form <- as.formula(paste0(tab$pheno[i], paste('~ HYPERTENSION + Zmrs_HEnet + AGE + GENDER + BMI + CENTER + BKGRD1_C7 + EV1 + EV2 + EV3 + EV4 + EV5'))) #Zmrs_HEnet
    mod <- svyglm(form, design = survey_obj, family = "gaussian")
    tab$coef[i] <- summary(mod)$coefficients[2,1]
    tab$p.val[i] <- summary(mod)$coefficients[2,4]
    tab$lower[i] <- confint(mod)[2,1]
    tab$upper[i] <- confint(mod)[2,2]
  } 
hyp <- tab %>% mutate(condition='Hypertension')

# Cognitive score baseline
tab <- data.frame(pheno=c('SLPA54','SLPA91','SLPA92'),
                  coef=rep(1,3), p.val=rep(1,3),lower=rep(1,3),upper=rep(1,3))

for (i in 1:3){
    form <- as.formula(paste0(tab$pheno[i], paste('~ global_cog_score + Zmrs_HEnet + AGE + GENDER + BMI + CENTER + BKGRD1_C7 + EV1 + EV2 + EV3 + EV4 + EV5'))) #Zmrs_HEnet
    mod <- svyglm(form, design = survey_obj, family = "gaussian")
    tab$coef[i] <- summary(mod)$coefficients[2,1]
    tab$p.val[i] <- summary(mod)$coefficients[2,4]
    tab$lower[i] <- confint(mod)[2,1]
    tab$upper[i] <- confint(mod)[2,2]
  } 
cg <- tab %>% mutate(condition='cog_baseline')

# Cognitive score change
tab <- data.frame(pheno=c('SLPA54','SLPA91','SLPA92'),
                  coef=rep(1,3), p.val=rep(1,3),lower=rep(1,3),upper=rep(1,3))

for (i in 1:3){
    form <- as.formula(paste0(tab$pheno[i], paste('~ global_cog_score_change + Zmrs_HEnet + AGE + GENDER + BMI + CENTER + BKGRD1_C7 + EV1 + EV2 + EV3 + EV4 + EV5'))) #Zmrs_HEnet
    mod <- svyglm(form, design = survey_obj, family = "gaussian")
    tab$coef[i] <- summary(mod)$coefficients[2,1]
    tab$p.val[i] <- summary(mod)$coefficients[2,4]
    tab$lower[i] <- confint(mod)[2,1]
    tab$upper[i] <- confint(mod)[2,2]
  } 
cc <- tab %>% mutate(condition='cog_change')
res <- rbind(diab,hyp,cg,cc)
#write.csv(res,'~/OneDrive - Beth Israel Lahey Health/2023_methCRP/Results/Survey regression/20240517_slp_dis_w.csv',row.names = F)
```

## Association between MRS-CRP with phenotypes adjusting for PRS-CRP

### Data preparation
```{r}
# Read data
scsx <- read.csv('~/OneDrive - Beth Israel Lahey Health/2023_methCRP/Results/20240523_SOL_PRS_CSx.csv')
pheno <- read.csv('~/OneDrive - Beth Israel Lahey Health/2023_methCRP/Data/20240205_pheSol.csv')
ev5 <- read.csv("/Volumes/Sofer Lab/HCHS_SOL/Ancestry_files/UW_GAC_DMDA_20180516_local_ancestries/subject_annotation_2017-09-05.csv")
names(ev5)[2]<-'SOL_ID'

# Add genetic PCs
pheno <- merge(pheno, ev5[,c(2,5:9)],by='SOL_ID')
# Classify long and short sleep duration
pheno <- merge(pheno, scsx[,c(1,12,13)], by='SOL_ID')
pheno$cDur <- ifelse(pheno$SLPDUR>9, 'Long', ifelse(pheno$SLPDUR<6, 'Short', 'Norm'))
long <- subset(pheno, cDur%in%c('Long','Norm'))
long$cDur <- relevel(as.factor(long$cDur), ref = 'Norm')
# Set reference level for diabetes and hypertension
pheno$DIABETES2_INDICATOR <-relevel(as.factor(pheno$DIABETES2_INDICATOR), ref = 'Normal' )
pheno$HYPERTENSION <-relevel(as.factor(pheno$HYPERTENSION), ref = 'Normal' )

# Create survey objects
survey_obj <- svydesign(id=~PSU_ID, strata=~STRAT, weights=~WEIGHT_FINAL_NORM_OVERALL , data=pheno)
survey_obj <- subset(survey_obj,  !is.na(lgCrp))
survey_long <- svydesign(id=~PSU_ID, strata=~STRAT, weights=~WEIGHT_FINAL_NORM_OVERALL , data=long)
survey_long <- subset(survey_long,  !is.na(lgCrp))
```

### Adjusting for PRS-CRP
```{r}
tab <- data.frame(pheno=c('lgCrp', 'SLPA54', 'SLPA91', 'SLPA92', 
                          'DIABETES2_INDICATOR', 'HYPERTENSION', 'LongSlp'),
                  coef=rep(1,7), p.val=rep(1,7), lower=rep(1,7), upper=rep(1,7))

for (i in 1:7 ){
  if (i<5){
    form <- as.formula(paste0(tab$pheno[i], paste('~ Zmrs_HEnet + wsum_all  + AGE + GENDER + BMI + CENTER + BKGRD1_C7+ EV1 + EV2 + EV3 + EV4 + EV5'))) #Zmrs_HEnet
    mod <- svyglm(form, design = survey_obj, family = "gaussian")
    tab$coef[i] <- summary(mod)$coefficients[2,1]
    tab$p.val[i] <- summary(mod)$coefficients[2,4]
    tab$lower[i] <- confint(mod)[2,1]
    tab$upper[i] <- confint(mod)[2,2]
  }
  if (i %in% 5:6){
    form <- as.formula(paste0(tab$pheno[i], paste('~ Zmrs_HEnet + wsum_all + AGE + GENDER + BMI + CENTER + BKGRD1_C7+ EV1 + EV2 + EV3 + EV4 + EV5')))
    mod <- svyglm(form, design = survey_obj, family = quasibinomial(link = "logit"))
    tab$coef[i] <- summary(mod)$coefficients[2,1]
    tab$p.val[i] <- summary(mod)$coefficients[2,4]
    tab$lower[i] <- confint(mod)[2,1]
    tab$upper[i] <- confint(mod)[2,2]
  }
  if (i ==7 ) {
    form <- as.formula(paste0('cDur', paste('~ Zmrs_HEnet + wsum_all + AGE + GENDER + BMI + CENTER + BKGRD1_C7+ EV1 + EV2 + EV3 + EV4 + EV5')))
    mod <- svyglm(form, design = survey_long, family = quasibinomial(link = "logit"))
    tab$coef[i] <- summary(mod)$coefficients[2,1]
    tab$p.val[i] <- summary(mod)$coefficients[2,4]
    tab$lower[i] <- confint(mod)[2,1]
    tab$upper[i] <- confint(mod)[2,2]
  }
}
wprs <- tab %>% mutate(group='wPRS')
#write.csv(wprs,'~/OneDrive - Beth Israel Lahey Health/2023_methCRP/Results/Survey regression/20240524_wprs.csv',row.names = F)
```

## Lasso feature selection

### Read Data
```{r}
load('~/OneDrive - Beth Israel Lahey Health/2023_methCRP/Data/Lasso data/enet.RData')
chr_all <- read.csv("~/OneDrive - Beth Israel Lahey Health/2023_parquet_db_methylation/Data/infinium-methylationepic-v-1-0-b5-manifest-file.csv",skip=7)
names(chr_all)[2]<-'CpG'
phe <- read.csv('~/OneDrive - Beth Israel Lahey Health/2023_methCRP/Data/20240205_pheSol.csv')
ev5 <- read.csv("/Volumes/Sofer Lab/HCHS_SOL/Ancestry_files/UW_GAC_DMDA_20180516_local_ancestries/subject_annotation_2017-09-05.csv")
names(ev5)[2]<-'SOL_ID'
phe <- merge(phe, ev5[,c(2,5:9)],by='SOL_ID')
#26-S92, 24-S54, 25-S91, 15-diab, 9-hyper
# 96-S54, 60-61 s91-92 94-hyper 38-diab
```

### AHI (SLPA54)
```{r}
# Prepare x and y matrices
#p2 <- phe[,c(13,2,4:6,59:64,66,72:76,24)] 
p2 <- phe[,c(102,3,7,12,15,8,103:107,109,139:143,96)]
p2$BKGRD1_C7 <- as.character(p2$BKGRD1_C7)
p2 <- p2 %>% remove_rownames %>% column_to_rownames('Row_names')
p2 <- cbind(p2[,c(3,5:17)], dummy(p2))
p2 <- p2 %>% mutate_if(is.character, as.numeric)
p2$Row_names <- row.names(p2)
d$Row_names <- row.names(d)
data <- merge(p2, d, by='Row_names') 
data <- data[complete.cases(data$SLPA54),]
data <- data %>% remove_rownames %>% column_to_rownames('Row_names')
data$intercept <- rep(1, nrow(data))
data <- data[complete.cases(data$EV1),]
data <- data[complete.cases(data$BMI),]

# Prepare X matrix
x<-as.matrix(data[,c(ncol(data), 1:13, 15:20, 23:26, 28:(ncol(data)-1))])

# apply penalty only on CpGs and not on other variables
n_chem <- length(colnames(x)[25:ncol(x)])
p.fac = c(rep(0, ncol(x) - n_chem), rep(1, n_chem)) # intercept and cell components not included in selection

y <- data[,'SLPA54']

# Cross validation
set.seed(1997)
kcvlasso <- cv.glmnet(x, y, nfolds = 5,
                      type.measure = "deviance",
                      penalty.factor = p.fac)

ind_min <- which.min(kcvlasso$cvm)
selected_lambda <- kcvlasso$lambda[ind_min]

# Best lasso model
set.seed(1997)
lasso <- glmnet(x, y,
                lambda = selected_lambda,
                type.measure = "deviance", 
                penalty.factor = p.fac)
lasso_beta <- lasso$beta
mrs_coefs <- lasso_beta[grep("cg", rownames(lasso_beta)), "s0"]
mrs_coefs <- as.data.frame(mrs_coefs[which(mrs_coefs != 0)])
names(mrs_coefs) <- 'coef_AHI'
mrs_coefs$CpG <- row.names(mrs_coefs)
AHI <- merge(mrs_coefs,chr_all[,c(2,12,16)],by='CpG')
nrow(AHI)
```

### Minimum SpO2 (SLPA91)
```{r}
# Prepare x and y matrices
p2 <- phe[,c(102,3,7,12,15,8,103:107,109,139:143,60)]
p2$BKGRD1_C7 <- as.character(p2$BKGRD1_C7)
p2 <- p2 %>% remove_rownames %>% column_to_rownames('Row_names')
p2 <- cbind(p2[,c(3,5:17)], dummy(p2))
p2 <- p2 %>% mutate_if(is.character, as.numeric)
p2$Row_names <- row.names(p2)
d$Row_names <- row.names(d)
data <- merge(p2, d, by='Row_names') 
data <- data[complete.cases(data$SLPA91),]
data <- data %>% remove_rownames %>% column_to_rownames('Row_names')
data$intercept <- rep(1, nrow(data))
data <- data[complete.cases(data$EV1),]
data <- data[complete.cases(data$BMI),]

# Prepare X matrix
x<-as.matrix(data[,c(ncol(data), 1:13, 15:20, 23:26, 28:(ncol(data)-1))])

# apply penalty only on CpGs and not on other variables
n_chem <- length(colnames(x)[25:ncol(x)])
p.fac = c(rep(0, ncol(x) - n_chem), rep(1, n_chem)) # intercept and cell components not included in selection

y <- data[,'SLPA91']

# Cross validation
set.seed(1997)
kcvlasso <- cv.glmnet(x, y, nfolds = 5,
                      type.measure = "deviance",
                      penalty.factor = p.fac)

ind_min <- which.min(kcvlasso$cvm)
selected_lambda <- kcvlasso$lambda[ind_min]

# Best lasso model
set.seed(1997)
lasso <- glmnet(x, y,
                lambda = selected_lambda,
                type.measure = "deviance", 
                penalty.factor = p.fac)
lasso_beta <- lasso$beta
mrs_coefs <- lasso_beta[grep("cg", rownames(lasso_beta)), "s0"]
mrs_coefs <- as.data.frame(mrs_coefs[which(mrs_coefs != 0)])
names(mrs_coefs) <- 'coef_MinSpO2'
mrs_coefs$CpG <- row.names(mrs_coefs)
minO2 <- merge(mrs_coefs,chr_all[,c(2,12,16)],by='CpG')
nrow(minO2)
```

### Diabetes
```{r}
# Prepare x and y matrices
p2 <- phe[,c(102,3,7,12,15,8,103:107,109,139:143,38)]
p2$DIABETES2_INDICATOR <- ifelse(p2$DIABETES2_INDICATOR == 'Normal',0,1)
p2 <- p2 %>% remove_rownames %>% column_to_rownames('Row_names')
p2 <- cbind(p2[,c(3,5:17)], dummy(p2[,1:16]))
p2 <- p2 %>% mutate_if(is.character, as.numeric)
p2$Row_names <- row.names(p2)
d$Row_names <- row.names(d)
data <- merge(p2, d, by='Row_names') 
data$DIABETES2_INDICATOR<-as.character(data$DIABETES2_INDICATOR)
data <- data %>% remove_rownames %>% column_to_rownames('Row_names')
data$intercept <- rep(1, nrow(data))
data <- data[complete.cases(data$EV1),]
data <- data[complete.cases(data$BMI),]

# Prepare X matrix
x<-as.matrix(data[,c(ncol(data), 1:13, 15:20, 23:26, 28:(ncol(data)-1))])

# apply penalty only on CpGs and not on other variables
n_chem <- length(colnames(x)[25:ncol(x)])
p.fac = c(rep(0, ncol(x) - n_chem), rep(1, n_chem)) 
# intercept and cell components not included in selection

y <- data[,'DIABETES2_INDICATOR']

# CV
set.seed(1997)
kcvlasso <- cv.glmnet(x, y, nfolds = 5,
                      type.measure = "class", family='binomial',
                      penalty.factor = p.fac)

ind_min <- which.min(kcvlasso$cvm)
selected_lambda <- kcvlasso$lambda[ind_min]

# best lasso model
set.seed(1997)
lasso <- glmnet(x, y,
                lambda = selected_lambda,
                type.measure = "class", family='binomial',
                penalty.factor = p.fac)
lasso_beta <- lasso$beta
mrs_coefs <- lasso_beta[grep("cg", rownames(lasso_beta)), "s0"]
mrs_coefs <- as.data.frame(mrs_coefs[which(mrs_coefs != 0)])
names(mrs_coefs) <- 'coef_diab'
mrs_coefs$CpG <- row.names(mrs_coefs)
names(chr_all)[2]<-'CpG'
diab <- merge(mrs_coefs,chr_all[,c(2,12,16)],by='CpG')
nrow(diab)
```

### Hypertension
```{r}
# Prepare x and y matrices
p2 <- phe[,c(102,3,7,12,15,8,103:107,109,139:143,94)] 
p2$HYPERTENSION <- ifelse(p2$HYPERTENSION == 'Normal',0,1)
p2 <- p2 %>% remove_rownames %>% column_to_rownames('Row_names')
p2 <- cbind(p2[,c(3,5:17)], dummy(p2[,1:16]))
p2 <- p2 %>% mutate_if(is.character, as.numeric)
p2$Row_names <- row.names(p2)
d$Row_names <- row.names(d)
data <- merge(p2, d, by='Row_names') 
data$HYPERTENSION<-as.character(data$HYPERTENSION)
data <- data %>% remove_rownames %>% column_to_rownames('Row_names')
data$intercept <- rep(1, nrow(data))
data <- data[complete.cases(data$EV1),]
data <- data[complete.cases(data$BMI),]

# Prepare X matrix
x<-as.matrix(data[,c(ncol(data), 1:13, 15:20, 23:26, 28:(ncol(data)-1))])

# apply penalty only on CpGs and not on other variables
n_chem <- length(colnames(x)[25:ncol(x)])
p.fac = c(rep(0, ncol(x) - n_chem), rep(1, n_chem)) 
# intercept and cell components not included in selection

y <- data[,'HYPERTENSION']

# CV
set.seed(1997)
kcvlasso <- cv.glmnet(x, y, nfolds = 5,
                      type.measure = "class", family='binomial',
                      penalty.factor = p.fac)

ind_min <- which.min(kcvlasso$cvm)
selected_lambda <- kcvlasso$lambda[ind_min]

# best lasso model
set.seed(1997)
lasso <- glmnet(x, y,
                lambda = selected_lambda,
                type.measure = "class", family='binomial',
                penalty.factor = p.fac)
lasso_beta <- lasso$beta
mrs_coefs <- lasso_beta[grep("cg", rownames(lasso_beta)), "s0"]
mrs_coefs <- as.data.frame(mrs_coefs[which(mrs_coefs != 0)])
names(mrs_coefs) <- 'coef_hyper'
mrs_coefs$CpG <- row.names(mrs_coefs)
Hyper <- merge(mrs_coefs,chr_all[,c(2,12,16)],by='CpG')
nrow(Hyper)
```

## Cubic Spline Model

### Data preparation
```{r}
sdata <- read_csv('~/OneDrive - Beth Israel Lahey Health/2023_methCRP/Data/20240205_pheSol.csv')
ev5 <- read.csv("/Volumes/Sofer Lab/HCHS_SOL/Ancestry_files/UW_GAC_DMDA_20180516_local_ancestries/subject_annotation_2017-09-05.csv")
names(ev5)[2] <- 'SOL_ID'
sdata<-merge(sdata,ev5[,c(2,5:9)],by='SOL_ID')
sdata<-sdata[complete.cases(sdata$SLPDUR),]
sdata<-sdata[complete.cases(sdata$EV1),]
sdata<-sdata[complete.cases(sdata$BMI),]
```

### Fit model
```{r}
####### Blood CRP
mrs_gam <- mgcv::gam(Zmrs_HEnet ~ s(SLPDUR,bs='cr', k=3) +AGE + GENDER + BMI + CENTER + BKGRD1_C7+ EV1 + EV2 + EV3 + EV4 + EV5, data=sdata)
summary(mrs_gam)

preds.all <- predict(mrs_gam, newdata = sdata, type = 'terms', se.fit = TRUE)
preds_df <- data.frame(SLPDUR = sdata$SLPDUR, 
                       fit = preds.all$fit[,11], 
                       lwr = preds.all$fit[,11] - 1.96 * preds.all$se.fit[,11], 
                       upr = preds.all$fit[,11] + 1.96 * preds.all$se.fit[,11])
#write.csv(preds_df,'~/OneDrive - Beth Israel Lahey Health/2023_methCRP/Results/20240610_mrs_spline.csv',row.names = F)

bld_gam <- mgcv::gam(lgCrp ~ s(SLPDUR,bs='cr', k=3) +AGE + GENDER + BMI + CENTER + BKGRD1_C7+ EV1 + EV2 + EV3 + EV4 + EV5, data=sdata)
summary(bld_gam)
preds.all <- predict(bld_gam, newdata = sdata, type = 'terms', se.fit = TRUE)
preds_df <- data.frame(SLPDUR = sdata$SLPDUR, 
                       fit = preds.all$fit[,11], 
                       lwr = preds.all$fit[,11] - 1.96 * preds.all$se.fit[,11], 
                       upr = preds.all$fit[,11] + 1.96 * preds.all$se.fit[,11])
#write.csv(preds_df,'~/OneDrive - Beth Israel Lahey Health/2023_methCRP/Results/20240610_blood_spline.csv',row.names = F)
```


## OSA with and without EDS

### Data preparation
```{r}
ev5 <- read.csv("/Volumes/Sofer Lab/HCHS_SOL/Ancestry_files/UW_GAC_DMDA_20180516_local_ancestries/subject_annotation_2017-09-05.csv")
# OSA with EDS and without
sdata <- read.csv("/Volumes/Sofer Lab/HCHS_SOL/Datasets/metsleep_covariates_20200129.csv") 
sdata <- sdata[-which(duplicated(sdata)),]
scsx <- read.csv('~/OneDrive - Beth Israel Lahey Health/2023_methCRP/Results/20240523_SOL_PRS_CSx.csv')
ty <- read.delim('~/OneDrive - Beth Israel Lahey Health/2023_methCRP/CRP_PRS/constructed_PRSs/HCHS/20240130_Tianyi_HCHS_PRS_std.txt')
p_link <- read_sas('/Volumes/Sofer Lab/HCHS_SOL/Datasets/hchs_dbgap_id_mapping_200727.sas7bdat')
colnames(p_link)[1] <- 'ID_old'
p_link$ID <- str_remove(p_link$ID_old, "^0+")
names(p_link)[2] <- 'SOL_ID'
sdata <- merge(sdata, p_link[,2:3], by='ID')
sdata <- merge(sdata, scsx[,c(1,10,12)], by='SOL_ID')
names(ty)[c(1,3)] <- c('SOL_ID','std_ty')
sdata <- merge(sdata, ty[,c(1,3)], by='SOL_ID')
sdata$OSA <- ifelse(sdata$SLPA54>5,'OSA','Norm')
sdata$EDS <- ifelse(sdata$ESS>10,'EDS','Norm')

# nOSA: no OSA; OE: OSA with EDS; OnE: OSA without EDS
sdata$oe <- ifelse(sdata$OSA=='OSA' & sdata$EDS=='EDS','OE',
                 ifelse(sdata$OSA=='OSA' & sdata$EDS=='Norm', 'OnE','nOSA'))
table(sdata$oe)
sdata$oe <- relevel(as.factor(sdata$oe), ref = 'nOSA')
levels(sdata$oe)
names(ev5)[2] <- 'SOL_ID'
sdata <- merge(sdata, ev5[,c(2,5:9)],by='SOL_ID')
survey_base <- svydesign(id = ~PSU_ID,
                          strata = ~STRAT,
                          weights = ~WEIGHT_FINAL_NORM_OVERALL,
                          nest = TRUE,
                          data = sdata)
# OSA vs none-OSA
sdata$OSA <- relevel(as.factor(sdata$OSA), ref = 'Norm')
table(sdata$OSA)
survey_obj <- svydesign(id=~PSU_ID, strata=~STRAT, weights=~WEIGHT_FINAL_NORM_OVERALL , data=sdata)
```

### Multinomial logistic regression
```{r}
tab <- data.frame(pheno=rep(c('OE_nOSA','OnE_nOSA','OSA_nOSA'),3),
                  prs=c(rep('PRS-ty',3),rep('PRS-EUR',3),rep('PRS-wsum',3)),
                  Coef=rep(1,9),SE=rep(1,9), p=rep(1,9),lower=rep(1,9),upper=rep(1,9))
# PRS_Huang
# OSA-EDS
form <- as.formula(paste0('oe', paste('~ std_ty + AGE + BMI + GENDER + CENTER + BKGRD1_C7+ EV1 + EV2 + EV3 + EV4 + EV5'))) 
vglm_mod <- svy_vglm(form, design = survey_base, family = multinomial(refLevel = 'nOSA'), drop.unused.levels = TRUE)
mnm <- as.data.frame(summary(vglm_mod)$coeftable)
ci <- as.data.frame(confint(vglm_mod))
names(ci) <- c('lower','upper')
mnm <- cbind(mnm,ci)
tab[1:2,3:7] <- mnm[3:4,c(1,2,4:6)]

# OSA vs none-OSA
form <- as.formula(paste0('OSA', paste('~ std_ty + AGE + BMI + GENDER + CENTER + BKGRD1_C7+ EV1 + EV2 + EV3 + EV4 + EV5'))) 
mod <- svyglm(form, design = survey_obj, family = quasibinomial(link = "logit"))
tab$Coef[3] <- summary(mod)$coefficients[2,1]
tab$SE[3] <- summary(mod)$coefficients[2,2]
tab$p[3] <- summary(mod)$coefficients[2,4]
tab$lower[3] <- confint(mod)[2,1]
tab$upper[3] <- confint(mod)[2,2]

# PRS_CSx simple sum
# OSA-EDS
form <- as.formula(paste0('oe', paste('~ PRS_EUR_std + AGE + BMI + GENDER + CENTER + BKGRD1_C7+ EV1 + EV2 + EV3 + EV4 + EV5'))) 
vglm_mod <- svy_vglm(form, design = survey_base, family = multinomial(refLevel = 'nOSA'), drop.unused.levels = TRUE)
mnm <- as.data.frame(summary(vglm_mod)$coeftable)
ci <- as.data.frame(confint(vglm_mod))
names(ci) <- c('lower','upper')
mnm <- cbind(mnm,ci)
tab[4:5,3:7] <- mnm[3:4,c(1,2,4:6)]

# OSA vs none-OSA
form <- as.formula(paste0('OSA', paste('~ PRS_EUR_std + AGE + BMI + GENDER + CENTER + BKGRD1_C7+ EV1 + EV2 + EV3 + EV4 + EV5'))) 
mod <- svyglm(form, design = survey_obj, family = quasibinomial(link = "logit"))
tab$Coef[6] <- summary(mod)$coefficients[2,1]
tab$SE[6] <- summary(mod)$coefficients[2,2]
tab$p[6] <- summary(mod)$coefficients[2,4]
tab$lower[6] <- confint(mod)[2,1]
tab$upper[6] <- confint(mod)[2,2]

# PRS_CSx weighted sum
# OSA-EDS
form <- as.formula(paste0('oe', paste('~ wsum_all + AGE + BMI + GENDER + CENTER + BKGRD1_C7+ EV1 + EV2 + EV3 + EV4 + EV5'))) 
vglm_mod <- svy_vglm(form, design = survey_base, family = multinomial(refLevel = 'nOSA'), drop.unused.levels = TRUE)
mnm <- as.data.frame(summary(vglm_mod)$coeftable)
ci <- as.data.frame(confint(vglm_mod))
names(ci) <- c('lower','upper')
mnm <- cbind(mnm,ci)
tab[7:8,3:7] <- mnm[3:4,c(1,2,4:6)]

# OSA vs none-OSA
form <- as.formula(paste0('OSA', paste('~ wsum_all + AGE + BMI + GENDER + CENTER + BKGRD1_C7+ EV1 + EV2 + EV3 + EV4 + EV5'))) 
mod <- svyglm(form, design = survey_obj, family = quasibinomial(link = "logit"))
tab$Coef[9] <- summary(mod)$coefficients[2,1]
tab$SE[9] <- summary(mod)$coefficients[2,2]
tab$p[9] <- summary(mod)$coefficients[2,4]
tab$lower[9] <- confint(mod)[2,1]
tab$upper[9] <- confint(mod)[2,2]

tab$s.size <- 1
tab$s.size[c(1,4,7)] <- table(sdata$oe)[1] + table(sdata$oe)[2]
tab$s.size[c(2,5,8)] <- table(sdata$oe)[1] + table(sdata$oe)[3]
tab$s.size[c(3,6,9)] <- table(sdata$OSA)[1] + table(sdata$OSA)[2]
#write.csv(tab,'~/OneDrive - Beth Israel Lahey Health/2023_methCRP/Results/Survey regression/20240524_MNR_OE.csv',row.names = F)

```

## Blood- and PRS-CRP association analysis using all HCHS/SOL samples 

### Data preparation
```{r}
phen <- read.csv("/Volumes/Sofer Lab/HCHS_SOL/Datasets/metsleep_covariates_20200129.csv")
crp<-read.csv('/Volumes/Sofer Lab/HCHS_SOL/Datasets/ms0725_covariates_20190129.csv')
phen <- merge(phen, crp[,c(1,88)],by='ID')
phen$cDur<-ifelse(phen$SLPDUR>9,'Long',ifelse(phen$SLPDUR<6,'Short','Norm'))
phen$lgCrp <- log(as.numeric(phen$LABA91))
ev5 <- read.csv("/Volumes/Sofer Lab/HCHS_SOL/Ancestry_files/UW_GAC_DMDA_20180516_local_ancestries/subject_annotation_2017-09-05.csv")
p_link <- read_sas('/Volumes/Sofer Lab/HCHS_SOL/Datasets/hchs_dbgap_id_mapping_200727.sas7bdat')
colnames(p_link)[1] <- 'ID_old'
p_link$ID <-str_remove(p_link$ID_old, "^0+")
names(p_link)[2]<-'SOL_ID'
phen<-merge(phen,p_link[,2:3],by='ID')
names(ev5)[2] <- 'SOL_ID'
phen <- merge(phen, ev5[,c(2,5:9)], by='SOL_ID', all=T) # 12691 people with genetic data
phen <- phen[-which(phen$BKGRD1_C7%in%c('Q','')),]
phen$BKGRD1_C7 <- factor(phen$BKGRD1_C7,levels = c("0","1","2","3","4", "5","6"),
                          labels = c("Domician","Central American","Cuban","Mexican",
                                     "Puerto Rican","South American","More than one/Other heritage"))
phen$CENTER <- factor(phen$CENTER,levels = c("B","C","M","S"),labels=c("Bronx","Chicago", "Miami", "San Diego"))
phen$GENDER <- factor(phen$GENDER,levels = c("F","M"),labels=c("Female","Male"))
phen$DIABETES2_INDICATOR <- factor(as.character(phen$DIABETES2_INDICATOR),levels = c("1","0"),labels=c("Diabetes","Normal"))
phen$HYPERTENSION <- factor(as.character(phen$HYPERTENSION),levels = c("1","0"),labels=c("Hypertension","Normal"))

cog<-read.csv('/Volumes/Sofer Lab/HCHS_SOL/Datasets/20240205_global_cog_base_and_inca.csv')
phen <- merge(phen, cog[,c(2,3,5)], by='ID')
#write.csv(phen,'~/OneDrive - Beth Israel Lahey Health/2023_methCRP/Data/20240604_phen_all.csv',row.names = F)

sdata <- read.csv('~/OneDrive - Beth Israel Lahey Health/2023_methCRP/Data/20240604_phen_all.csv')
sdata$DIABETES2_INDICATOR <-relevel(as.factor(sdata$DIABETES2_INDICATOR), ref = 'Normal' )
sdata$HYPERTENSION <-relevel(as.factor(sdata$HYPERTENSION), ref = 'Normal' )
long <- subset(sdata, cDur%in%c('Long','Norm'))
long$cDur <- relevel(as.factor(long$cDur), ref = 'Norm')
short <- subset(sdata, cDur%in%c('Short','Norm'))
short$cDur <- relevel(as.factor(short$cDur), ref = 'Norm')

survey_obj <- svydesign(id=~PSU_ID, strata=~STRAT, weights=~WEIGHT_FINAL_NORM_OVERALL , data=sdata)
survey_obj <- subset(survey_obj,  !is.na(lgCrp))
survey_long <- svydesign(id=~PSU_ID, strata=~STRAT, weights=~WEIGHT_FINAL_NORM_OVERALL , data=long)
survey_long <- subset(survey_long,  !is.na(lgCrp))
survey_short <- svydesign(id=~PSU_ID, strata=~STRAT, weights=~WEIGHT_FINAL_NORM_OVERALL , data=short)
survey_short <- subset(survey_short,  !is.na(lgCrp))
```

### Blood CRP association
```{r}
tab <- data.frame(pheno=c('SLPA54', 'SLPA91', 'SLPA92', 'SLPA97', 'SLPDUR', 'WHIIRS',
                          'global_cog_score', 'global_cog_score_change', 'ESS',
                          'DIABETES2_INDICATOR', 'HYPERTENSION', 'LongSlp', 'ShortSlp'),
                  coef=rep(1,13), p.val=rep(1,13), lower=rep(1,13), upper=rep(1,13))

for (i in 1:13){
  if (i<10){
    form <- as.formula(paste0(tab$pheno[i], paste('~ lgCrp + AGE + GENDER + BMI + CENTER + BKGRD1_C7'))) 
    mod <- svyglm(form, design = survey_obj, family = "gaussian")
    tab$coef[i] <- summary(mod)$coefficients[2,1]
    tab$p.val[i] <- summary(mod)$coefficients[2,4]
    tab$lower[i] <- confint(mod)[2,1]
    tab$upper[i] <- confint(mod)[2,2]
  }
  if (i %in% 10:11){
    form <- as.formula(paste0(tab$pheno[i], paste('~ lgCrp + AGE + GENDER + BMI + CENTER + BKGRD1_C7')))
    mod <- svyglm(form, design = survey_obj, family = quasibinomial(link = "logit"))
    tab$coef[i] <- summary(mod)$coefficients[2,1]
    tab$p.val[i] <- summary(mod)$coefficients[2,4]
    tab$lower[i] <- confint(mod)[2,1]
    tab$upper[i] <- confint(mod)[2,2]
  }
  if (i %in% 12:13) {
    form <- as.formula(paste0('cDur', paste('~ lgCrp + AGE + GENDER + BMI + CENTER + BKGRD1_C7')))
    if (i==12){
    mod <- svyglm(form, design = survey_long, family = quasibinomial(link = "logit"))
    } else {
      mod <- svyglm(form, design = survey_short, family = quasibinomial(link = "logit"))
    }
    tab$coef[i] <- summary(mod)$coefficients[2,1]
    tab$p.val[i] <- summary(mod)$coefficients[2,4]
    tab$lower[i] <- confint(mod)[2,1]
    tab$upper[i] <- confint(mod)[2,2]
  }
}
crp <- tab %>% mutate(group='Blood_CRP') # max sample size 16331
crp$s.size <- 1
dt <- sdata[complete.cases(sdata$lgCrp),]
crp$s.size[1] <- nrow(dt[complete.cases(dt$SLPA54),])
crp$s.size[2:4] <- nrow(dt[complete.cases(dt$SLPA91),])
crp$s.size[5] <- nrow(dt[complete.cases(dt$SLPDUR),])
crp$s.size[6] <- nrow(dt[complete.cases(dt$WHIIRS),])
crp$s.size[7] <- nrow(dt[complete.cases(dt$global_cog_score),])
crp$s.size[8] <- nrow(dt[complete.cases(dt$global_cog_score_change),])
crp$s.size[9] <- nrow(dt[complete.cases(dt$ESS),])
crp$s.size[10:11] <- nrow(dt[complete.cases(dt$DIABETES2_INDICATOR),])
crp$s.size[12] <- nrow(long[complete.cases(long$lgCrp),])
crp$s.size[13] <- nrow(short[complete.cases(short$lgCrp),])

#write.csv(crp,'~/OneDrive - Beth Israel Lahey Health/2023_methCRP/Results/Survey regression/20240604_lgCRP_all.csv',row.names = F)
```

### PRS CRP association
```{r}
scsx <- read.csv('~/OneDrive - Beth Israel Lahey Health/2023_methCRP/Results/20240523_SOL_PRS_CSx.csv')

# Prepare survey objects
pdata <- merge(sdata, scsx[,c(1, 10, 12, 13)], by='SOL_ID') # 12320 samples
long <- subset(pdata, cDur%in%c('Long','Norm'))
long$cDur <- relevel(as.factor(long$cDur), ref = 'Norm')
short <- subset(pdata, cDur%in%c('Short','Norm'))
short$cDur <- relevel(as.factor(short$cDur), ref = 'Norm')

tab <- data.frame(pheno=c('lgCrp', 'SLPA54', 'SLPA91', 'SLPA92', 'SLPA97', 'SLPDUR', 'WHIIRS',
                          'global_cog_score', 'global_cog_score_change', 'ESS',
                          'DIABETES2_INDICATOR', 'HYPERTENSION', 'LongSlp', 'ShortSlp'),
                  coef=rep(1,14), p.val=rep(1,14), lower=rep(1,14), upper=rep(1,14))

survey_obj <- svydesign(id=~PSU_ID, strata=~STRAT, weights=~WEIGHT_FINAL_NORM_OVERALL , data=pdata)
survey_obj <- subset(survey_obj,  !is.na(lgCrp))
survey_long <- svydesign(id=~PSU_ID, strata=~STRAT, weights=~WEIGHT_FINAL_NORM_OVERALL , data=long)
survey_long <- subset(survey_long,  !is.na(lgCrp))
survey_short <- svydesign(id=~PSU_ID, strata=~STRAT, weights=~WEIGHT_FINAL_NORM_OVERALL , data=short)
survey_short <- subset(survey_short,  !is.na(lgCrp))

# Run the analysis
for (i in 1:14){
  if (i<11){
    form <- as.formula(paste0(tab$pheno[i], paste('~ PRS_EUR_std + AGE + GENDER + BMI + CENTER + BKGRD1_C7 + EV1 + EV2 + EV3 + EV4 + EV5'))) #Zmrs_HEnet
    mod <- svyglm(form, design = survey_obj, family = "gaussian")
    tab$coef[i] <- summary(mod)$coefficients[2,1]
    tab$p.val[i] <- summary(mod)$coefficients[2,4]
    tab$lower[i] <- confint(mod)[2,1]
    tab$upper[i] <- confint(mod)[2,2]
  }
  if (i %in% 11:12){
    form <- as.formula(paste0(tab$pheno[i], paste('~ PRS_EUR_std + AGE + GENDER + BMI + CENTER + BKGRD1_C7+ EV1 + EV2 + EV3 + EV4 + EV5')))
    mod <- svyglm(form, design = survey_obj, family = quasibinomial(link = "logit"))
    tab$coef[i] <- summary(mod)$coefficients[2,1]
    tab$p.val[i] <- summary(mod)$coefficients[2,4]
    tab$lower[i] <- confint(mod)[2,1]
    tab$upper[i] <- confint(mod)[2,2]
  }
  if (i %in% 13:14) {
    form <- as.formula(paste0('cDur', paste('~ PRS_EUR_std + AGE + GENDER + BMI + CENTER + BKGRD1_C7+ EV1 + EV2 + EV3 + EV4 + EV5')))
    if (i==13){
    mod <- svyglm(form, design = survey_long, family = quasibinomial(link = "logit"))
    } else {
      mod <- svyglm(form, design = survey_short, family = quasibinomial(link = "logit"))
    }
    tab$coef[i] <- summary(mod)$coefficients[2,1]
    tab$p.val[i] <- summary(mod)$coefficients[2,4]
    tab$lower[i] <- confint(mod)[2,1]
    tab$upper[i] <- confint(mod)[2,2]
  }
}
eur <- tab %>% mutate(group='PRS_EUR')

for (i in 1:14){
  if (i<11){
    form <- as.formula(paste0(tab$pheno[i], paste('~ wsum_all + AGE + GENDER + BMI + CENTER + BKGRD1_C7 + EV1 + EV2 + EV3 + EV4 + EV5'))) 
    mod <- svyglm(form, design = survey_obj, family = "gaussian")
    tab$coef[i] <- summary(mod)$coefficients[2,1]
    tab$p.val[i] <- summary(mod)$coefficients[2,4]
    tab$lower[i] <- confint(mod)[2,1]
    tab$upper[i] <- confint(mod)[2,2]
  }
  if (i %in% 11:12){
    form <- as.formula(paste0(tab$pheno[i], paste('~ wsum_all + AGE + GENDER + BMI + CENTER + BKGRD1_C7+ EV1 + EV2 + EV3 + EV4 + EV5')))
    mod <- svyglm(form, design = survey_obj, family = quasibinomial(link = "logit"))
    tab$coef[i] <- summary(mod)$coefficients[2,1]
    tab$p.val[i] <- summary(mod)$coefficients[2,4]
    tab$lower[i] <- confint(mod)[2,1]
    tab$upper[i] <- confint(mod)[2,2]
  }
  if (i %in% 13:14) {
    form <- as.formula(paste0('cDur', paste('~ wsum_all + AGE + GENDER + BMI + CENTER + BKGRD1_C7+ EV1 + EV2 + EV3 + EV4 + EV5')))
    if (i==13){
    mod <- svyglm(form, design = survey_long, family = quasibinomial(link = "logit"))
    } else {
      mod <- svyglm(form, design = survey_short, family = quasibinomial(link = "logit"))
    }
    tab$coef[i] <- summary(mod)$coefficients[2,1]
    tab$p.val[i] <- summary(mod)$coefficients[2,4]
    tab$lower[i] <- confint(mod)[2,1]
    tab$upper[i] <- confint(mod)[2,2]
  }
}

# Combine results
wsum.all <- tab %>% mutate(group='PRS_wsum_all')

for (i in 1:14){
  if (i<11){
    form <- as.formula(paste0(tab$pheno[i], paste('~ wsum_hisp + AGE + GENDER + BMI + CENTER + BKGRD1_C7 + EV1 + EV2 + EV3 + EV4 + EV5'))) #Zmrs_HEnet
    mod <- svyglm(form, design = survey_obj, family = "gaussian")
    tab$coef[i] <- summary(mod)$coefficients[2,1]
    tab$p.val[i] <- summary(mod)$coefficients[2,4]
    tab$lower[i] <- confint(mod)[2,1]
    tab$upper[i] <- confint(mod)[2,2]
  }
  if (i %in% 11:12){
    form <- as.formula(paste0(tab$pheno[i], paste('~ wsum_hisp + AGE + GENDER + BMI + CENTER + BKGRD1_C7+ EV1 + EV2 + EV3 + EV4 + EV5')))
    mod <- svyglm(form, design = survey_obj, family = quasibinomial(link = "logit"))
    tab$coef[i] <- summary(mod)$coefficients[2,1]
    tab$p.val[i] <- summary(mod)$coefficients[2,4]
    tab$lower[i] <- confint(mod)[2,1]
    tab$upper[i] <- confint(mod)[2,2]
  }
  if (i %in% 13:14) {
    form <- as.formula(paste0('cDur', paste('~ wsum_hisp + AGE + GENDER + BMI + CENTER + BKGRD1_C7+ EV1 + EV2 + EV3 + EV4 + EV5')))
    if (i==13){
      mod <- svyglm(form, design = survey_long, family = quasibinomial(link = "logit"))
    } else {
      mod <- svyglm(form, design = survey_short, family = quasibinomial(link = "logit"))
    }
    tab$coef[i] <- summary(mod)$coefficients[2,1]
    tab$p.val[i] <- summary(mod)$coefficients[2,4]
    tab$lower[i] <- confint(mod)[2,1]
    tab$upper[i] <- confint(mod)[2,2]
  }
}

# Combine results
wsum.hisp <- tab %>% mutate(group='PRS_wsum_hisp')
res <- rbind(eur, wsum.all, wsum.hisp)
res$s.size <- 1
dt <- sdata[complete.cases(sdata$lgCrp),]
dt <- dt[complete.cases(dt$EV1),]
res <- res[order(res$pheno),]
row.names(res) <- 1:nrow(res)
res$s.size[c(1:3,13:15,16:18)] <- nrow(dt)
res$s.size[4:6] <- nrow(dt[complete.cases(dt$ESS),])
res$s.size[7:9] <- nrow(dt[complete.cases(dt$global_cog_score),])
res$s.size[10:12] <- nrow(dt[complete.cases(dt$global_cog_score_change),])
l2<- long[complete.cases(long$EV1),]
res$s.size[19:21] <- nrow(l2[complete.cases(l2$lgCrp),])
s2<- short[complete.cases(short$EV1),]
res$s.size[22:24] <- nrow(s2[complete.cases(s2$lgCrp),])
res$s.size[25:27] <- nrow(dt[complete.cases(dt$SLPA54),])
res$s.size[28:36] <- nrow(dt[complete.cases(dt$SLPA91),])
res$s.size[37:39] <- nrow(dt[complete.cases(dt$SLPDUR),])
res$s.size[40:42] <- nrow(dt[complete.cases(dt$WHIIRS),])
#write.csv(res,'~/OneDrive - Beth Israel Lahey Health/2023_methCRP/Results/Survey regression/20240604_PRS_all.csv',row.names = F)
```


